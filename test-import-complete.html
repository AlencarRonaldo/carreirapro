<!DOCTYPE html>
<html>
<head>
    <title>Teste de Importa√ß√£o - Valida√ß√£o Completa</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        #results { margin-top: 20px; }
        .log-entry { margin: 5px 0; padding: 5px; background: #f8f9fa; border-left: 3px solid #007bff; }
    </style>
</head>
<body>
    <h1>Teste de Importa√ß√£o - Valida√ß√£o Completa</h1>
    
    <div class="test-section info">
        <h3>Instru√ß√µes</h3>
        <p>1. Abra o DevTools (F12) para ver os logs do console</p>
        <p>2. Clique no bot√£o para testar a importa√ß√£o</p>
        <p>3. Verifique se os dados aparecem nas se√ß√µes correspondentes</p>
    </div>

    <div class="test-section">
        <h3>Controles de Teste</h3>
        <button onclick="testEventListeners()" class="btn-primary">Testar Event Listeners</button>
        <button onclick="simulateImport()" class="btn-success">Simular Importa√ß√£o Completa</button>
        <button onclick="clearResults()" class="btn-secondary">Limpar Resultados</button>
    </div>

    <div id="results"></div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(logMessage);
            testResults.push({ message: logMessage, type });
            updateResults();
        }

        function updateResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>Resultados dos Testes</h3>' + 
                testResults.map(r => `<div class="log-entry">${r.message}</div>`).join('');
        }

        function clearResults() {
            testResults = [];
            updateResults();
        }

        // Monitorar eventos customizados
        ['experiences-reload', 'education-reload', 'skills-reload', 'profile-updated'].forEach(eventType => {
            window.addEventListener(eventType, (e) => {
                log(`‚úÖ Evento recebido: ${eventType}`, 'success');
                if (e.detail) {
                    log(`üì¶ Detalhes do evento: ${JSON.stringify(e.detail)}`, 'info');
                }
            });
        });

        // Monitorar addEventListener para verificar se os hooks est√£o registrando listeners
        const originalAddEventListener = window.addEventListener;
        window.addEventListener = function(type, listener) {
            if (type.includes('reload') || type.includes('updated')) {
                log(`üëÇ Event listener registrado: ${type}`, 'info');
            }
            return originalAddEventListener.call(this, type, listener);
        };

        function testEventListeners() {
            log('üöÄ Iniciando teste de event listeners...', 'info');
            
            // Testar cada evento individualmente
            setTimeout(() => {
                log('üì§ Disparando experiences-reload...', 'info');
                window.dispatchEvent(new CustomEvent('experiences-reload'));
            }, 500);

            setTimeout(() => {
                log('üì§ Disparando education-reload...', 'info');
                window.dispatchEvent(new CustomEvent('education-reload'));
            }, 1000);

            setTimeout(() => {
                log('üì§ Disparando skills-reload...', 'info');
                window.dispatchEvent(new CustomEvent('skills-reload'));
            }, 1500);

            setTimeout(() => {
                log('üì§ Disparando profile-updated...', 'info');
                window.dispatchEvent(new CustomEvent('profile-updated', { 
                    detail: { profile: { id: 'test', fullName: 'Teste' } }
                }));
            }, 2000);
        }

        function simulateImport() {
            log('üéØ Simulando importa√ß√£o completa do LinkedIn/PDF...', 'info');
            
            // Simular dados de resposta da API
            const mockImportResponse = {
                id: 'user123',
                fullName: 'Jo√£o Silva',
                headline: 'Desenvolvedor Full Stack Senior',
                email: 'joao.silva@email.com',
                experiences: [
                    {
                        id: 'exp1',
                        title: 'Desenvolvedor Senior',
                        company: 'Tech Solutions Ltd',
                        startDate: '2020-01-01',
                        endDate: null,
                        description: 'Desenvolvimento de aplica√ß√µes web modernas usando React, Node.js e TypeScript'
                    },
                    {
                        id: 'exp2', 
                        title: 'Desenvolvedor Pleno',
                        company: 'Startup Inovadora',
                        startDate: '2018-06-01',
                        endDate: '2019-12-31',
                        description: 'Desenvolvimento de MVP para startup de fintech'
                    }
                ],
                education: [
                    {
                        id: 'edu1',
                        institution: 'Universidade Federal de S√£o Paulo',
                        degree: 'Bacharelado em Ci√™ncia da Computa√ß√£o',
                        startDate: '2014-02-01',
                        endDate: '2017-12-01'
                    }
                ],
                skills: [
                    { id: 'skill1', name: 'JavaScript', level: 5 },
                    { id: 'skill2', name: 'React', level: 4 },
                    { id: 'skill3', name: 'Node.js', level: 4 },
                    { id: 'skill4', name: 'TypeScript', level: 4 },
                    { id: 'skill5', name: 'PostgreSQL', level: 3 }
                ]
            };

            // Simular o fluxo de importa√ß√£o
            setTimeout(() => {
                log('üì• Dados recebidos da API de importa√ß√£o', 'success');
                log(`üìä Experi√™ncias: ${mockImportResponse.experiences.length}`, 'info');
                log(`üéì Educa√ß√£o: ${mockImportResponse.education.length}`, 'info'); 
                log(`‚ö° Skills: ${mockImportResponse.skills.length}`, 'info');
                
                // Disparar eventos como o useProfile faria
                if (mockImportResponse.experiences.length > 0) {
                    log('üîÑ Disparando experiences-reload...', 'info');
                    window.dispatchEvent(new CustomEvent('experiences-reload'));
                }
                
                if (mockImportResponse.education.length > 0) {
                    log('üîÑ Disparando education-reload...', 'info');
                    window.dispatchEvent(new CustomEvent('education-reload'));
                }
                
                if (mockImportResponse.skills.length > 0) {
                    log('üîÑ Disparando skills-reload...', 'info');
                    window.dispatchEvent(new CustomEvent('skills-reload'));
                }
                
                log('üîÑ Disparando profile-updated...', 'info');
                window.dispatchEvent(new CustomEvent('profile-updated', { 
                    detail: { profile: mockImportResponse }
                }));
                
                log('‚úÖ Simula√ß√£o de importa√ß√£o conclu√≠da!', 'success');
                
            }, 1000);
        }

        // Inicializar
        log('üåê P√°gina de teste carregada', 'info');
        log('üìç Aguardando intera√ß√£o do usu√°rio...', 'info');
    </script>
</body>
</html>